<!DOCTYPE html>
<html>
<head>
    <title>SuperNote Home</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Welcome to SuperNote</h1>

        <p id="welcome-message">Checking session...</p>

        <div class="button-group">
            <button id="login-btn" class="btn-secondary">Login</button>
            <button id="signup-btn" class="btn-secondary">Signup</button>
            <button id="logout-btn" class="btn-primary" style="display:none;">Logout</button>
        </div>
    </div>

    <script>
        // ตรวจสอบ session
        async function checkSession() {
            try {
                const response = await fetch('http://localhost:5000/api/session', {
                    method: 'GET',
                    credentials: 'include'
                });

                const result = await response.json();
                const message = document.getElementById('welcome-message');
                const logoutBtn = document.getElementById('logout-btn');
                const loginBtn = document.getElementById('login-btn');
                const signupBtn = document.getElementById('signup-btn');

                if (result.logged_in) {
                    message.innerText = `Hello, ${result.username}!`;
                    logoutBtn.style.display = 'inline-block';
                    loginBtn.style.display = 'none';
                    signupBtn.style.display = 'none';
                } else {
                    message.innerText = 'You are not logged in.';
                    logoutBtn.style.display = 'none';
                    loginBtn.style.display = 'inline-block';
                    signupBtn.style.display = 'inline-block';
                }
            } catch (error) {
                document.getElementById('welcome-message').innerText = 'Session check failed.';
            }
        }

        // logout
        document.getElementById('logout-btn').addEventListener('click', async function () {
            try {
                const response = await fetch('http://localhost:5000/api/logout', {
                    method: 'POST',
                    credentials: 'include'
                });

                const result = await response.json();
                alert(result.message);
                window.location.reload();
            } catch (error) {
                alert('Logout failed.');
            }
        });

        // redirect to login
        document.getElementById('login-btn').addEventListener('click', function () {
            window.location.href = 'login.html';
        });

        // redirect to signup
        document.getElementById('signup-btn').addEventListener('click', function () {
            window.location.href = 'signup.html';
        });

        checkSession();
    </script>
</body>
</html>
